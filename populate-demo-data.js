const sqlite3 = require('sqlite3').verbose();
const path = require('path');

// Conectar a la base de datos
const db = new sqlite3.Database('./sports_medicine.db');

// Datos de ejemplo para medicina del deporte
const demoData = {
  folders: [
    {
      name: "Lesiones Deportivas",
      subcarpetas: [
        "Lesiones del LCA",
        "Lesiones Musculares", 
        "Fracturas por Estr√©s",
        "Lesiones del Hombro",
        "Conmociones Cerebrales"
      ]
    },
    {
      name: "Rendimiento Deportivo",
      subcarpetas: [
        "Entrenamiento de Fuerza",
        "Resistencia Cardiovascular",
        "Velocidad y Agilidad", 
        "An√°lisis Biomec√°nico",
        "Periodizaci√≥n"
      ]
    },
    {
      name: "Nutrici√≥n Deportiva",
      subcarpetas: [
        "Suplementaci√≥n",
        "Hidrataci√≥n",
        "Nutrici√≥n Pre-Competencia",
        "Recuperaci√≥n Nutricional",
        "Composici√≥n Corporal"
      ]
    },
    {
      name: "Rehabilitaci√≥n",
      subcarpetas: [
        "Fisioterapia Deportiva",
        "Ejercicios Terap√©uticos",
        "Tecnolog√≠as de Recuperaci√≥n",
        "Retorno al Deporte",
        "Prevenci√≥n Secundaria"
      ]
    },
    {
      name: "Psicolog√≠a del Deporte",
      subcarpetas: [
        "Motivaci√≥n y Concentraci√≥n",
        "Manejo del Estr√©s",
        "Confianza Deportiva",
        "Cohesi√≥n de Equipo",
        "Burnout Atl√©tico"
      ]
    },
    {
      name: "Fisiolog√≠a del Ejercicio",
      subcarpetas: [
        "Metabolismo Energ√©tico",
        "Adaptaciones Cardiovasculares",
        "Respuesta Hormonal",
        "Fatiga Muscular",
        "Termorregulaci√≥n"
      ]
    },
    {
      name: "Medicina Preventiva",
      subcarpetas: [
        "Screening Cardiovascular",
        "Evaluaciones Pretemporada",
        "Programas de Prevenci√≥n",
        "Vacunaci√≥n en Atletas",
        "Salud Mental"
      ]
    },
    {
      name: "Dopaje y Antidoping",
      subcarpetas: [
        "Sustancias Prohibidas",
        "Procedimientos de Control",
        "Exenciones Terap√©uticas",
        "Educaci√≥n Antidopaje",
        "Casos y Jurisprudencia"
      ]
    },
    {
      name: "Deporte Femenino",
      subcarpetas: [
        "Tr√≠ada de la Atleta",
        "Ciclo Menstrual y Rendimiento",
        "Embarazo y Deporte",
        "Lesiones Espec√≠ficas",
        "Diferencias Fisiol√≥gicas"
      ]
    },
    {
      name: "Deportes Espec√≠ficos",
      subcarpetas: [
        "F√∫tbol",
        "Baloncesto",
        "Atletismo",
        "Nataci√≥n",
        "Deportes de Combate"
      ]
    }
  ],
  
  // T√≠tulos de documentos realistas por subcarpeta
  documentTitles: {
    "Lesiones del LCA": [
      "Efectividad de la Reconstrucci√≥n del LCA con Injerto de Tend√≥n Rotuliano vs Isquiotibiales",
      "Programas de Prevenci√≥n de Lesiones del LCA en F√∫tbol Femenino",
      "Biomec√°nica del Aterrizaje y Riesgo de Lesi√≥n del LCA",
      "Factores de Riesgo Hormonales en Lesiones del LCA en Mujeres Atletas",
      "Resultados a Largo Plazo de la Reconstrucci√≥n del LCA en Atletas Profesionales"
    ],
    "Lesiones Musculares": [
      "Clasificaci√≥n de Lesiones Musculares por Resonancia Magn√©tica",
      "PRP vs Plasma Rico en Plaquetas en Lesiones de Isquiotibiales",
      "Factores de Riesgo de Lesiones Musculares en Sprinters",
      "Protocolos de Retorno al Juego post Lesi√≥n Muscular",
      "Excentric Training para Prevenci√≥n de Lesiones Musculares"
    ],
    "Fracturas por Estr√©s": [
      "Fracturas por Estr√©s en Corredores de Marat√≥n: Incidencia y Factores de Riesgo",
      "Papel de la Vitamina D en la Prevenci√≥n de Fracturas por Estr√©s",
      "Densitometr√≠a √ìsea en Atletas con Fracturas por Estr√©s Recurrentes",
      "Tratamiento Conservador vs Quir√∫rgico en Fracturas por Estr√©s del Escafoides",
      "Biomec√°nica de la Carrera y Fracturas por Estr√©s de Tibia"
    ],
    "Lesiones del Hombro": [
      "Impingement Subacromial en Nadadores: Diagn√≥stico y Tratamiento",
      "Inestabilidad Glenohumeral en Deportes de Lanzamiento",
      "Lesiones del Manguito Rotador en Atletas Overhead",
      "Artroscopia vs Tratamiento Conservador en Lesiones SLAP",
      "Programas de Fortalecimiento para Prevenci√≥n de Lesiones del Hombro"
    ],
    "Conmociones Cerebrales": [
      "Protocolo de Retorno al Juego post Conmoci√≥n Cerebral",
      "Biomarcadores Sangu√≠neos en Conmociones Cerebrales Deportivas",
      "Efectos a Largo Plazo de Conmociones Repetidas en NFL",
      "Evaluaci√≥n Neuropsicol√≥gica en Atletas con Conmoci√≥n",
      "Prevenci√≥n de Conmociones en Deportes de Contacto"
    ],
    "Entrenamiento de Fuerza": [
      "Periodizaci√≥n del Entrenamiento de Fuerza en Atletas Elite",
      "Entrenamiento Isom√©trico vs Din√°mico para Desarrollo de Fuerza",
      "Efectos del Entrenamiento de Fuerza en Adolescentes Atletas",
      "Optimizaci√≥n de la Hipertrofia Muscular en Deportistas",
      "Entrenamiento de Fuerza Espec√≠fico para Deportes de Resistencia"
    ],
    "Resistencia Cardiovascular": [
      "Entrenamiento Intervalado de Alta Intensidad vs Continuo Moderado",
      "Adaptaciones Cardiovasculares al Entrenamiento en Altitud",
      "VO2max y Rendimiento en Deportes de Resistencia",
      "Fatiga Cardiovascular en Ultra Maratones",
      "Monitorizacion de la Frecuencia Card√≠aca en el Entrenamiento"
    ],
    "Velocidad y Agilidad": [
      "Biomec√°nica de la Aceleraci√≥n en Sprints de 100 metros",
      "Entrenamiento Pliom√©trico para Mejora de la Velocidad",
      "Agilidad Reactiva vs Programada en Deportes de Equipo",
      "Efectos del Entrenamiento de Fuerza en la Velocidad M√°xima",
      "An√°lisis Cinem√°tico de Cambios de Direcci√≥n en F√∫tbol"
    ],
    "An√°lisis Biomec√°nico": [
      "An√°lisis 3D de la T√©cnica de Lanzamiento en Jabalina",
      "Biomec√°nica de la T√©cnica de Nado en Crol",
      "Eficiencia Mec√°nica en la Carrera de Fondo",
      "An√°lisis de Fuerzas en el Salto Vertical",
      "Biomec√°nica del Swing en Golf: Factores de Rendimiento"
    ],
    "Periodizaci√≥n": [
      "Modelos de Periodizaci√≥n en Deportes C√≠clicos vs Ac√≠clicos",
      "Periodizaci√≥n del Entrenamiento en Deportes de Equipo",
      "Tapering: Estrategias de Reducci√≥n Pre-Competitiva",
      "Periodizaci√≥n Inversa en Deportes de Resistencia",
      "Monitorizaci√≥n de la Carga de Entrenamiento y Recuperaci√≥n"
    ]
  }
};

async function createDemoData() {
  return new Promise((resolve, reject) => {
    console.log('üöÄ Iniciando creaci√≥n de datos de demostraci√≥n...');
    
    db.serialize(() => {
      let foldersCreated = 0;
      let subfoldersCreated = 0;
      let summariesCreated = 0;
      
      // Crear carpetas principales y subcarpetas
      demoData.folders.forEach((folderData, index) => {
        // Crear carpeta principal
        db.run('INSERT INTO folders (name, parent_id) VALUES (?, ?)', 
          [folderData.name, null], 
          function(err) {
            if (err) {
              console.error(`Error creando carpeta ${folderData.name}:`, err);
              return;
            }
            
            const parentId = this.lastID;
            foldersCreated++;
            console.log(`üìÅ Creada carpeta principal: ${folderData.name} (ID: ${parentId})`);
            
            // Crear subcarpetas
            folderData.subcarpetas.forEach((subcarpetaName, subIndex) => {
              db.run('INSERT INTO folders (name, parent_id) VALUES (?, ?)', 
                [subcarpetaName, parentId], 
                function(err) {
                  if (err) {
                    console.error(`Error creando subcarpeta ${subcarpetaName}:`, err);
                    return;
                  }
                  
                  const subcarpetaId = this.lastID;
                  subfoldersCreated++;
                  console.log(`  üìÇ Creada subcarpeta: ${subcarpetaName} (ID: ${subcarpetaId})`);
                  
                  // Crear documentos de ejemplo para esta subcarpeta
                  const titles = demoData.documentTitles[subcarpetaName] || [
                    `Estudio sobre ${subcarpetaName} - Revisi√≥n Sistem√°tica`,
                    `An√°lisis Cl√≠nico de ${subcarpetaName} en Atletas Elite`,
                    `Protocolo de Tratamiento para ${subcarpetaName}`,
                    `Factores de Riesgo en ${subcarpetaName}`,
                    `Nuevas Tendencias en ${subcarpetaName}`
                  ];
                  
                  titles.forEach((title, docIndex) => {
                    const summary = `RESUMEN EJECUTIVO: ${title}
                    
OBJETIVO: Analizar los aspectos m√°s relevantes de ${subcarpetaName} en el contexto de la medicina del deporte moderna.

METODOLOG√çA: Revisi√≥n sistem√°tica de literatura cient√≠fica publicada entre 2020-2024, incluyendo estudios randomizados controlados, meta-an√°lisis y revisiones de expertos.

POBLACI√ìN: Atletas profesionales y semi-profesionales de diferentes disciplinas deportivas, edades entre 18-35 a√±os.

RESULTADOS PRINCIPALES:
‚Ä¢ Identificaci√≥n de factores clave que influyen en ${subcarpetaName}
‚Ä¢ Establecimiento de protocolos de intervenci√≥n basados en evidencia
‚Ä¢ An√°lisis de efectividad de diferentes enfoques terap√©uticos
‚Ä¢ Evaluaci√≥n de outcomes a corto y largo plazo

CONCLUSIONES: Los hallazgos sugieren la importancia de un enfoque multidisciplinario para abordar ${subcarpetaName}, integrando aspectos biomec√°nicos, fisiol√≥gicos y psicol√≥gicos.`;

                    const criticalAnalysis = `AN√ÅLISIS CR√çTICO - ${title}

FORTALEZAS METODOL√ìGICAS:
‚Ä¢ Dise√±o de estudio robusto con adecuado poder estad√≠stico
‚Ä¢ Criterios de inclusi√≥n y exclusi√≥n bien definidos
‚Ä¢ Seguimiento longitudinal apropiado para el tipo de intervenci√≥n
‚Ä¢ Uso de herramientas de medici√≥n validadas

LIMITACIONES IDENTIFICADAS:
‚Ä¢ Tama√±o muestral limitado para subgrupos espec√≠ficos
‚Ä¢ Posible sesgo de selecci√≥n en la poblaci√≥n estudiada
‚Ä¢ Variabilidad en protocolos de implementaci√≥n entre centros
‚Ä¢ Tiempo de seguimiento insuficiente para outcomes a largo plazo

RELEVANCIA CL√çNICA:
La evidencia presentada tiene implicaciones directas para la pr√°ctica cl√≠nica en medicina del deporte, especialmente en el manejo de ${subcarpetaName}. Se recomienda implementaci√≥n gradual con monitoreo continuo.

CALIDAD DE EVIDENCIA: Moderada a Alta
GRADO DE RECOMENDACI√ìN: B (Se recomienda su implementaci√≥n)`;

                    const keywords = `${subcarpetaName}, medicina deportiva, atletas, evidencia cient√≠fica, protocolo cl√≠nico, rendimiento deportivo, prevenci√≥n, tratamiento`;
                    
                    db.run('INSERT INTO summaries (folder_id, title, original_text, summary, critical_analysis, keywords) VALUES (?, ?, ?, ?, ?, ?)',
                      [subcarpetaId, title, `Texto original completo del documento: ${title}...`, summary, criticalAnalysis, keywords],
                      function(err) {
                        if (err) {
                          console.error(`Error creando resumen ${title}:`, err);
                          return;
                        }
                        summariesCreated++;
                        console.log(`    üìÑ Creado documento: ${title}`);
                        
                        // Verificar si hemos terminado
                        if (summariesCreated === demoData.folders.length * 5 * 5) {
                          console.log(`\n‚úÖ DATOS DE DEMOSTRACI√ìN CREADOS EXITOSAMENTE:`);
                          console.log(`   üìÅ ${foldersCreated} carpetas principales`);
                          console.log(`   üìÇ ${subfoldersCreated} subcarpetas`);
                          console.log(`   üìÑ ${summariesCreated} documentos simulados`);
                          console.log(`\nüéØ ¬°Listo para la presentaci√≥n!`);
                          resolve();
                        }
                      });
                  });
                });
            });
          });
      });
    });
  });
}

// Funci√≥n para limpiar datos existentes (opcional)
function clearExistingData() {
  return new Promise((resolve) => {
    console.log('üßπ Limpiando datos existentes...');
    db.serialize(() => {
      db.run('DELETE FROM summaries', () => {
        db.run('DELETE FROM state_of_art', () => {
          db.run('DELETE FROM folders', () => {
            console.log('‚úÖ Datos anteriores eliminados');
            resolve();
          });
        });
      });
    });
  });
}

// Ejecutar el script
async function main() {
  try {
    await clearExistingData();
    await createDemoData();
    console.log('\nüéâ ¬°Script completado exitosamente!');
    console.log('üí° Ahora puedes iniciar la aplicaci√≥n y mostrar el flujo completo');
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Error ejecutando el script:', error);
    process.exit(1);
  }
}

main();